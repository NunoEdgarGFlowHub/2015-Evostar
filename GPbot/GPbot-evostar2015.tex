
%%%%%%%%%%%%%%%%%%%%%%% file typeinst.tex %%%%%%%%%%%%%%%%%%%%%%%%%
%
% This is the LaTeX source for the instructions to authors using
% the LaTeX document class 'llncs.cls' for contributions to
% the Lecture Notes in Computer Sciences series.
% http://www.springer.com/lncs       Springer Heidelberg 2006/05/04
%
% It may be used as a template for your own input - copy it
% to a new file with a new name and use it as the basis
% for your article.
%
% NB: the document class 'llncs' has its own and detailed documentation, see
% ftp://ftp.springer.de/data/pubftp/pub/tex/latex/llncs/latex2e/llncsdoc.pdf
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\documentclass[runningheads,a4paper]{llncs}

\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}

\usepackage{url}
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\begin{document}

\mainmatter  % start of an individual contribution

% first the title is needed
\title{It's time to stop: investigating termination conditions in the evolution of game bots}

% a short form should be given in case it is too long for the running head
\titlerunning{It's time to stop}

% the name(s) of the author(s) follow(s) next
%
% NB: Chinese authors should write their first names(s) in front of
% their surnames. This ensures that the names appear correctly in
% the running heads and the author index.
%
\author{Non A. Me%
\thanks{NoInstitute}}
%
\authorrunning{Me, N}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{No Institute}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the document class "llncs.cls".
%

\maketitle

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   ABSTRACT   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{abstract}
Evolutionary Algorithms are frequently used as a mechanism for the off-line optimization of autonomous agents in games (bots).
Determining the end of the evolutionary process in this stage is not as easy as it would a priori seem. 
% Antonio - Yo introducirï¿½a el entorno del problema mejor. No todos los lectores sabrï¿½n quï¿½ quiere decir o e quï¿½ consiste 'the evolutionary process in the design of a game bot'... Lo he hecho con una frase al principio. ;)
Usually running for a constant amount of generations is considered as an acceptable criteria, if the obtained bots are good enough. However this is not the best approach, so other options must be explored.
% Antonio - he aï¿½adido el tï¿½pico criterio de parada basado en generaciones
The first issue is that there is no known optimum, because most games make sure
% Antonio - 'make sure' es como si el juego se asegurase de eso. Al diseï¿½ar un juego no creo que se piense mucho en esta posibilidad. ;D
 that there is no single best way of creating a bot that defeats all enemies; once it is found, there is no challenge left. 
% Antonio - repito, esto no es algo de lo que los diseï¿½adores del juego se preocupen
Then, in most games, fitness is noisy, so that even if you consider reaching a certain level of fitness as a termination condition, there is no guarantee that the individual with that fitness is not going to turn into a worse one (regarding fitness) next generation it is evaluated. 
% Antonio - he reescrito un poco esto. Los individuos no cambian, cambia su evaluaciï¿½n. Lo he dejado mï¿½s o menos igual, aunque creo que mejor expresado en este sentido.
Other possibilities, such as certain level of victories over external enemies as a termination condition, present the problem that the bots will be overfitted to
those particular enemies. 
% Antonio - De hecho, usar mï¿½ltiples enemigos externos es la mejor forma de evaluaciï¿½n (si no es un co-evolutivo), ya que asï¿½ se lucha contra la sobre-especializaciï¿½n. Usar una condiciï¿½n de parada basada en eso serï¿½a el mejor enfoque, que pero se necesitan muuuchos enemigos.
Even as any of these conditions is not perfect, there is the possibility of combining several of them as termination condition so that bots that are as optimal as possible, (and in as general a context as it is possible) are found; also, in a minimal amount of time and evaluations. In this paper
we will examine several ways of ending an evolutionary
game bot design process, determining the capabilities of every one of
them and, eventually, selecting one for future designs. 
We will use a particular game, Planet Wars, in which we already have some experience, but the conclusions to our study could, in principle, be extended to any RTS or even any game with non-deterministic match results and with an
unknown best solution.
% Antonio - faltarï¿½a la ï¿½ltima frase con las conclusiones que se alcancen, no?
\keywords{Videogames, RTS, evolutionary algorithms, termination criteria}
% Antonio - no hay co-evoluciï¿½n!!!
\end{abstract}

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   INTRODUCTION   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Introduction}

The termination condition is a key factor in any algorithm and its experimental setup since it affects the algorithmic performance, with respect to the quality of the yielded solution, and also to the amount of resources devoted to the run. 
In Evolutionary Algorithms (EAs)\cite{EAs_Back96} the usual termination condition is a constant number of generations (or evaluations), 
%Maribel: el nÃºmero de generaciones y el nÃºmero de evaluaciÃ³nes estÃ¡n relacionadas sÃ³lo en poblaciones de tamaÃ±o fijo. Yo las tratarÃ­a como condiciones de parada en algunos Ã¡mbitos, aunque no sÃ© si nos interesa o no tratarlos separados o simplemente decir que en este caso son lo mismo aunque para otros entornos no tiene por quÃ© serlo.
 which is normally related to a fixed {\em computing cycles budget}
for doing the run or to a number of generations in
which the best solution is not improved (distance to the optimum is not reduced), among others \cite{RocheTermination13}. However, neither of them might be useful in certain problems such as games, mainly due to the noisy nature of the fitness function \cite{merelo14:noisy,Mora2012Genebot}. 

This \textit{noise} is inherent to most games, since the enemy, the game environment, the bot itself, or all of them, may have an stochastic component which might make the result of a match vary from one time to another. Thus, the evaluation results would be yielded every time the fitness is measured. 

In this scope, EAs are usually applied to find the best autonomous agent for playing the game, i.e. the best \textit{bot} \cite{Agent_Smith_CEC2009,Mora-Evo2010,Esparcia10FPS,FernandezAres2012adaptive}.

The usual approach in this scope is using a fixed number of evaluations or amount of time, usually given by the game or challenge conditions. 
This is obviously not the right approach for finding the best autonomous agent, or even one that is good enough to defeat those of the state of the art. 

That is why finding the optimal termination condition is essential in the search for game bots that competes in a particular challenge. If there is not a fixed evaluation budget, the next usual solution is to give it as much as you have got, 
% Antonio - 'as you have got'??? En qué? A qué te refieres?
which is fair if you are designing a bot %maribel, el got no se suele poner 
to participate in a competition \cite{DBLP:conf/cec/Fernandez-AresMGGF11}. However, from a methodological point of view, if you want to compare different approaches to design a bot it needs to be done in conditions that are as similar as possible, which 
%maribel sustituir "conditions that are as similar as possible" por "similar environments, "
might make {\em as much as you have got} a bit short on
details. 
% Antonio - no entiendo esto de 'short on details'

Whenever different methods are going to be compared, they need to have an %Maribel usar are going es si lo fueras a hacer ahora mismo, es presente continuo, yo no usarÃ­a ni ese tiempo ni por supuesto el futuro, a no ser que estÃ©s hablando de las lÃ­neas futuras del artÃ­culo. Yo pondrÃ­a "Compared methods need stop by the same independent stopping criteriun, since... 
independent stopping criterion, since using any method for the same
time or for the same number of evaluations is not usually fair. 
% Antonio - Explicar por qué no es justo.
This makes, from the methodological point of view, inadequate to use the
number of computing cycles as a termination condition.
% Antonio - 'computing cycles' no es lo mismo que 'number of evaluations'
 
This is a general problem for most kinds of games, as in many other
problems without a known (or reachable) set of solutions. 
This issue arises in games due to the noisy and combat-based methods used for the evolution of bots, because there is not a single way to compute the fitness. Any approach you choose, it is usually impossible to reach a global optimum short 
% Antonio - short???
from managing to obtain a bot that, as in Sun Tzu's ``Art of war'' \cite{tzu2013art}, is able to beat the opponent without
fighting, as the opponents are not known before the EA is running. 
% Antonio - esta frase no se entiende
To solve this, usually previously-known opponents are used in the fitness
function and an ``optimum'' is reached when a certain number of
victories are achieved against them.
%Maribel, achieved en vez de obtained. 
However, this may lead to generate overfitted solutions that only beat the  enemies that have been used during the 'training' phase (to compute the fitness) \cite{DBLP:journals/jcst/MoraFGGF12}.

In this paper, we present a study on different termination conditions to 
generate competitive bots for videogames using Genetic Programming (GP) \cite{GP_Koza92}, because this method has proved to be quite flexible and has obtained very good results in previous works [CITA GPBOT]. 
% Antonio - poner cita del EVO* aunque sea 'To appear'
The game \textit{Planet Wars}
% Antonio - poner cita o URL al juego
 has been chosen in our experimental setup, as it is a simple RTS (Real Time Simulator) combat-based game (only one type of resource, one type of attack and one type of unit), and also it has been widely used in the literature, using different generation methods and fitness functions 
\cite{DBLP:journals/jcst/MoraFGGF12,DBLP:conf/cec/Fernandez-AresMGGF11,DBLP:journals/nc/Lara-CabreraCL14,NogueiraCoevolutionary14}. 

Summarizing, our objective in this study is to find the stop criteria that converges to good solutions (the optimal, if possible). %Maribel: Anadir al final de la frase, saving resources and time. 
% Antonio - he puesto 'optimal', pero no sé se dejarlo como 'best'
To measure the quality of every approach, we will %maribel: quitar el will
consider the time needed to obtain the solution and the
quality of that solution as metrics. In principle, the termination
condition chosen could be extrapolated to any game with
stochastic behaviour and combat-based results.
%maribel: Esta Ãºltima frase es bastante fuerte, decimos sin mÃ¡s que nuestros resultados se pueden extrapolar a un montÃ³n de cosas, sin probar nada, eso serÃ¡ asÃ­?
% Antonio - Sí, esto hay que justificarlo mucho mejor. ¿por qué estamos convencidos de que se podrá extrapolar? Hay que fijar bien las características para que se pueda extrapolar efectivamente, etc.

The rest of the paper is organized as follows. Next section
establishes the state of the art in the use of termination conditions
for this kind of evolutionary algorithms in which the optimum is not
known and/or with the presence of a noisy environment or fitness evaluation. Then in Section \ref{sec:met} we will %Maribel: quitar el will de la frase
present the different termination
conditions %maribel Borrar desde aquÃ­ hasta "and how ... " osea que la frase quedarÃ­a mucho mÃ¡s corta y sencilla "Next in Section \ref{sec:met} we present the different termination conditions and how they contribute to ...
we will be checking in this work and how they contribute to
prove which one has better behaviour in this context; we will also
sketch the problem we are using in this particular paper, evolution of
bot for Planet Wars. Results will be presented in Section
\ref{sec:met}, followed by the conclusions and a discussion of the
implication of the obtained results.
% Antonio - esto habría que reescribirlo mejor y con los contenidos reales. ;D


%maribel: En realidad, este Ãºltimo pÃ¡rrafo lo simplifiquÃ© y reescribÃ­ entero tal y como os pongo aquÃ­ abajo
%The rest of the paper is organized as follows. Next, section \ref{sec:SoA} establishes the state of the art related to termination conditions for evolutionary algorithms in which the optimum is not known and/or is noisy. Following, section \ref{sec:met} presents the set of termination conditions which have been checked in this paper and how they contribute to prove which one has better behaviour in this context; we also sketch the problem we have used in this particular paper, evolution of bot for Planet Wars. Results are presented in Section \ref{sec:met}, followed by the conclusions and a discussion of the implication of the obtained results.

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  STATE OF THE ART  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{State of the Art}
\label{sec:SoA}

%% TODO: esto estÃ¡ en redacciÃ³n...

Real world optimization problems often involve uncertain environment including noisy and/or dynamic environments \cite{Jin2005303,QianYZ13}.
Basic strategies to handle noisy fitness functions include using a larger population size, averaging to filter out the noise (re-sampling) \cite{Branke98,Branke2001}, thresholding (employing a threshold value to be used in a selection operator for noisy fitness functions) \cite{Markon2001} or changing the selection criteria.
Other authors propose complex methods such as including the multipopulation approach, special operators or case-based memory \cite{BhattacharyaIM14}. 

%--- Took out reference to our own paper, which should be taken out to the intro. I don't think anything above this is really relevant, other than referencing a very general paper that deals with noise (or our own paper at IJCCCI) - JJ


In \cite{merelo14:noisy}, Merelo et al. propose dealing with the problem of noisy fitness functions using two methods, the former based on re-evaluation of surviving individuals and the latter that uses a Wilcoxon test to compare a sample of individuals and partial-order them within the population.

% TERMINATION CRITERIA

As many EA depend on population diversity for its evolution, a termination condition given in terms of the rate of population diversity decrease would be useful. 
In this sense, Roche et al. \cite{RocheTermination13} propose terminating the evolution process by analyzing the EA population diversity. Thus, they presents a numeric approximation to steady states that is used to detect the moment that the population has lost its diversity for algorithm termination.


Usually, the algorithm termination is decided based on a heuristic stopping criteria, such as the maximum number of evaluations or on reaching a performance level during the run. 
When the algorithm converges, it is terminated in order to avoid wasting computational resources.
Although these criteria are suitable for well defined benchmark problems (the optimum is known), they are not applicable to real world problems. 
In these cases, more sophisticated heuristic stopping criteria have to be used \cite{NME2909,Wagner2009,Wagner2010}.

In the last years some adaptive alternatives have been proposed  as termination conditions.
In this sense, Safe et al. \cite{Safe2004} present a review of the state-of-the-art in the design of termination conditions and convergence analysis in GAs.
The main problem is determining an accurate value for the number of generations, so that the GA convergence is guaranteed.
Authors propose searching the minimum number of generations by means of a convergence analysis \cite{Rudolph1994}.


Finally, as stated in Hart et al. \cite{Hart1996} when calculating metrics of parallel performance, it is incorrect to stop a parallel EA either after a fixed number of iterations or when the average fitness exhibits little variation. In this case, stopping rules based on the attainment of thresholds should be used, i.e. stopping the run when a solution that reaches this threshold is found \cite{Sena2001}. Nevertheless, threshold definition requires a good estimation of the optimum of the problem under study, which is unavailable in many cases \cite{Safe2004}.

% A conclusion should be added to this based on the last paragraph - JJ

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  METHODOLOGY  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Methodology and experimental setup}
\label{sec:met}

This section describes the different termination approaches to be tested in the paper. Everyone is commented and justified.
Then, the parameter setup and the different experiments to be conducted are also presented and discussed. The aim is to analyse the differences in performance obtained with each configuration.

% --------------------------------------------------------------

\subsection{GA features}

...\\

% Cada vez que Antonio usa considered, Dios mata a un gatito - JJ
In this paper, we use a generational approach [REF] in order to have a high level of diversity, % justificarlo
which is better for checking some of the stop criteria to test. % ¿por qué? - JJ
Specifically those population-based ones, which are normally more sensitive to diverse populations.
%maribel: Por qué es mejor tener diversidad para probar criterios de parada?, esto será mejor para algunos criterios, pero no para todos, de hecho los criterios de parada más utilizados, como el número de evaluaciones o el número de generaciones, no tienen nada que ver con la diversidad de la población. Sí es verdad que es importante para criterios basados en alguna metrica basada en la población, como el fitness medio en relación al mejor fitness, o criterios basados en algún tipo de distancia entre los individuos de la población, pero no para todos los criterios de parada en general, como parece que dice la frase anterior, así que creo que hay que justificar mejor el que el algoritmo sea generacional. Pongo a continuación una posible justificación a ver qué os parece.
% Antonio - Pos eso es lo que habia puesto yo. XD 
% Me has movido al frase en la que aclaraba eso mismo. Además de que desde el principio ponía 'some of the stop criteria'. ;D
% Esta frase no tiene sentido. - JJ

%The aim of this paper is to test which is the best way for stopping an evolutionary algorithm to find an autonomous and winner agent for playing a game. We have selected several stopping criteria, some of them, are controlled only by one or more evolutionary paremeter, but others by some features of the population. Due to this kind of stopping criteria, the diversity of the population should be preserved. For this reason, the generational approach is a good option for our test setup.  


In addition, we have tried to reduce the effects of the noisy
evaluation \cite{Genebot_JCST} by computing fitness from the result of
30 matches against an expert rival, ExpGenebot proposed in
\cite{Genebot_CIG2012} and based on the improvement of the heuristics
proposed by a human player and which is, for this particular game, the state
of the art. ExpGenebot adapts its behaviour doing an initial analysis
of the battle map and depending on the balance of forces between it and the enemy, i.e. location of the fleets and amount of ships.
This rival has been chosen due to its potential variety of behaviours,
so 30 different representative maps have been chosen for each
evaluation, to ensure the bot behaves in a different way in every
match. Thus, the fitness evaluation enhances the value of an
individual. 
% He anonimizado las referencias. Pero ¿son 30 batallas en 30 mapas o
% sólo 30 batallas, cada una en un mapa?

%***
%TODO: Definir la función de SCORE
%***

% --------------------------------------------------------------

\subsection{Termination Criteria}
% Antonio - Maribel, criteria es el plural de criterion. ;)

The traditional set of stopping criteria are either based on stagnation, checking for the exitence of a solution in the set and a fixed budget. Combining them we have designed a set of five different algorithm stop criteria are going to be checked in the paper, namely:

\begin{itemize}
    \item \textit{Number of generations} is the classical termination
      criteria in evolutionary algorithms. We will consider 30, 50 and 100 generations since some papers
      [CITA EVO* 2014] have mentioned the middle value. As indicated in the previous section,
      Hart \cite{Hart1996} claims that this is not the right way to
      compare different approaches; however, we include it here as a
      baseline for comparison with the other approaches. % En ese caso yo creo que no habría que probar tantos valores diferentes.

    \item \textit{Age of outliers}: if the age of one individual is an outlier in the comparison with the rest of the population then it would be potentially an optimal solution % why?
and the algorithm can be stopped. The difference between the age of the outlier and the rest of the population is measured considering three factors: 1, 1.5 and 2 times the interquartile range (IQR). %explain a bit. Does this mean that it will stop when it finds somebody that is two times as old as the average? - JJ

    \item \textit{Fitness threshold}: a maximum value to obtain in the evolution can be set considering the top limit of the score function, 45. Thus, three possible thresholds are defined,
% After a phase of systematic experimentation?
namely 30, 36, 42. These values have been set considering that the ideal fitness/score to obtain is 45, but this is not effectively reachable (the bot must win all the matches in just one turn). %Los valores son bastante arbitrarios, pero bueno. 
In general, setting a fixed value that is a certain distance away to a known (and maybe unreachable) optimum is a compromise solution, since it is not known in advance whether this lower level will be even reached and, if it is, what would be the effort needed to go beyond that and whether a better solution (even including noise) could be found with a higher value. 
%En este caso, ¿no se tiene en cuenta el ruido? - JJ

    \item \textit{Fitness improvement}: in an ideal evolutionary process the fitness of the best individual must be improved during evolution every generation. However, the noisy nature of the problem (or the noisy fitness function) makes this difficult to measure. Thus, if the best fitness is not improved during a number of generations, the algorithm stops. Again three possible values will be tested: 3, 7 and 10 generations. %maribel y por qué estos? está fijado antes en algún otro paper como el del número de gneraciones?
These values have been set after a dedicated systematic experimentation phase as they are minimum and maximum thresholds plus an intermediate value. 
% Antonio - aclarado. Es la más difícil de justificar. 
% JJ - yo probaría más valores. En todo caso, el fitness variará cada generación si se vuelve a ejecutar, ¿no? 

    \item \textit{Replacement rate}: when using an elitist strategy in which individuals are replaced only if the new generation is better, the fact that the population stops generating better individuals might be a sign of stagnation. Three
      different rates have been tested, namely 25\%, 12.5\%, 6.25\%... % but this has to be combined with a steady state approach or something. By itself, it does not mean a thing. Please explain - JJ
% Antonio - en la descripción del algoritmo se habrá dicho que va a ser generacional (hecho), ya que en un estacionario la tasa de reemplazo estaría mucho más acotada. ;)
% Maribel: En un algoritmo generacional clásico, se reemplaza toda la población con los hijos menos el mejor. Pero nosotros no estamos usando este reemplazo, así como así, sino que hacemos unión de los hijos y los padres y nos quedamos con los mejores N no? Si esto es así, sería una cosa a comentar en la sección de GA features.
% Antonio - efectivamente, he intentado contarlo mejor debajo. En todo caso hay que aclararlo en la descripción del algoritmo. - TODO -
% Aquí había que haber hecho una aclaración o referencia al mismo. Ya lo he aclarado - JJ
   The values are based in the maximum number of replacements per generation. Our model defines a maximum of n/2 (50\%) individuals to be potentially substituted by the offspring. Thus, the parameter values aim to test half of this probability, and half of the previous values, respectively.
\end{itemize}

The first stop criterion is based in an algorithmic parameter, so the algorithm stops when this parameter reaches a value. For this criterion, the population status does not matter. The rest of criteria are population-based ones, i.e. they consider some of its features to test if the algorithm must stop. The feature of the population leads the stop criteria and so leads the end of the algorithm. 

The objective of these experiments % is to test the set of termination criteria... %el objetivo no es nunca ``probar'' esto. Es solucionar un problema. 

% Habrá que decir qué se va a medir y por qué. ¿Qué se compara? ¿Por qué?
%
%%%%%%%%%%%%%%%%%%%%%%%%%%  EXPERIMENTS AND RESULTS  %%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Experiments and Results}
\label{sec:results}

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  CONCLUSIONS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Conclusions}

%% En las conclusiones no debemos olvidar sentar las bases de los tipos de problemas/algoritmos a los que se podrían extrapolar o generalizar los resultados.

%% - fitness óptimo no conocido
%% - ¿entorno ruidoso?
%% - que se usen mecanismos para paliar la influencia del ruido es importante (podría ser requerido)
% No se usa ningún mecanismo para ``paliar'' el ruido. Sí se intenta trabajar con él.

\section*{Acknowledgements}

Hidden for double-blind review

% References missing:
%Warning--I didn't find a database entry for "Mora2012Genebot"
%Warning--I didn't find a database entry for "Esparcia10FPS"
%Warning--I didn't find a database entry for "FernandezAres2012adaptive"

\bibliographystyle{unsrt}
\bibliography{geneura,references,gpbot,genebot}

\end{document}
