%%%%%%%%%%%%%%%%%%%%%%% file typeinst.tex %%%%%%%%%%%%%%%%%%%%%%%%%
%
% This is the LaTeX source for the instructions to authors using
% the LaTeX document class 'llncs.cls' for contributions to
% the Lecture Notes in Computer Sciences series.
% http://www.springer.com/lncs       Springer Heidelberg 2006/05/04
%
% It may be used as a template for your own input - copy it
% to a new file with a new name and use it as the basis
% for your article.
%
% NB: the document class 'llncs' has its own and detailed documentation, see
% ftp://ftp.springer.de/data/pubftp/pub/tex/latex/llncs/latex2e/llncsdoc.pdf
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\documentclass[runningheads,a4paper]{llncs}

\usepackage[latin1]{inputenc}
\usepackage{amssymb}
\usepackage{amsmath}
\setcounter{tocdepth}{3}
\usepackage{graphicx}

\usepackage{url}
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\begin{document}

\mainmatter  % start of an individual contribution

% first the title is needed
\title{It's time to stop: A comparison of termination conditions in the evolution of game bots}

% a short form should be given in case it is too long for the running head
\titlerunning{It's time to stop}

% the name(s) of the author(s) follow(s) next
%
% NB: Chinese authors should write their first names(s) in front of
% their surnames. This ensures that the names appear correctly in
% the running heads and the author index.
%
\author{Non A. Me%
\thanks{NoInstitute}}
%
\authorrunning{Me, N}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{No Institute}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the document class "llncs.cls".
%

\maketitle

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   ABSTRACT   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{abstract}
Evolutionary Algorithms are frequently used as a mechanism for the
optimization of autonomous agents in games (bots), but knowing when to
stop evolving, that is, when the bots are good enough, is not as easy as it would a priori seem. 
The first issue is that the optimal bots are either not known (and
thus unusable as termination condition) or unreachable; then, in most
games, the fitness evaluation (normally based in playing the game) is
noisy, making its use as a termination condition also complicated.  
% Reescrito todo que el abstract ocupa casi una página
A fixed amount of evaluations or, in the case of games, a certain
level of victories does not guarantee an optimal result.
%% The termination strategies left are independent of the algorithm:
%% running for a constant amount of generations is often considered as an
%% acceptable criteria, if the obtained bots are good enough. However
%% this is not necessarily the best approach, since further optimization
%% could lie ahead, so other options must be explored.  
%% Other possibilities, such as certain level of victories (or fitness
%% quality) over external enemies as a termination condition, present the
%% problem that the bots will be overfitted to those particular enemies. 
% Antonio - De hecho, usar múltiples enemigos externos es la mejor forma de evaluación (si no es un co-evolutivo), ya que así se lucha contra la sobre-especialización. Usar una condición de parada basada en eso sería el mejor enfoque, que pero se necesitan muuuchos enemigos.
% Antonio - he añadido el típico criterio de parada basado en generaciones
%% Even as any of these conditions is not perfect, there is the
%% possibility of combining several of them as termination criterion so
%% that bots that are as optimal as possible, (and in as general a
%% context as it is possible) are found; also, in a minimal amount of
%% time and evaluations. 
That is why the objective of this paper is evaluate several
termination conditions in order to find one that is able to yield a
good solution in a certain amount of time, and that allows researchers
to compare between different evolutionary algorithms as fairly as
possible. To achieve that objective we will examine several ways of
ending an evolutionary game bot design process in a particular game,
Planet Wars, with the characteristics described above, determining the capabilities of every one of
them and, eventually, selecting one for future designs.
%% We will use a particular game, Planet Wars, which has been studied
%% extensively in the literature, but the conclusions to our study could,
%% in principle, be extended to any Real Time Strategy (RTS) game or even to any game with non-deterministic match results and with an unknown best solution.
% Antonio - También se habló de extrapolar los resultados a otros problemas con características comunes a estos, es decir: Fitness ruidoso, sin óptimo conocido, etc, no?
% Antares - Sería lo suyo . Por ejemplo, hablando con Gustavo y Maribel, 
% hemos dicho que realmente estas condiciones de parada son aplicables a cualquier juego.
% Antonio - faltaría la última frase con las conclusiones que se alcancen, no?
% Antares - Digo yo :P
\keywords{Videogames, RTS, evolutionary algorithms, termination criteria, noisy fitness, no-optimal solution}
\end{abstract}

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   INTRODUCTION   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Introduction}


Evolutionary Algorithms (EAS) are one of the methods usually applied
to find the best autonomous agent for playing a game, i.e. the best \textit{bot}
\cite{Agent_Smith_CEC2009,bots:evostar,unreal:gecco10,DBLP:conf/cig/Fernandez-AresGMG12}
through an evolutionary process.
As in any other algorithm, the termination condition is a key factor, along with its experimental setup since it affects the algorithmic performance, with respect to the quality of the yielded solution, and also to the amount of resources devoted to the run. 
The usual stop criterion in EAs \cite{EAs_Back96} is reaching a constant number of generations (or evaluations), 
%Maribel: el nÃºmero de generaciones y el nÃºmero de evaluaciÃ³nes
%estÃ¡n relacionadas sÃ³lo en poblaciones de tamaÃ±o fijo. Yo las
%tratarÃ­a como condiciones de parada en algunos Ã¡mbitos, aunque no
%sÃ© si nos interesa o no tratarlos separados o simplemente decir que
%en este caso son lo mismo aunque para otros entornos no tiene por
%quÃ© serlo.
% Maribel da exactamente igual. Lo importante es el número de
% evaluaciones. - JJ
 which is normally related to a fixed {\em computing cycles budget}
for doing the run. Another usual approach is based in a number of generations in
which the best solution is not improved (distance to the optimum is not reduced) \cite{RocheTermination13}. However, neither of them might be useful in certain problems such as games, mainly due to the noisy nature of the fitness function \cite{merelo14:noisy,bots:evostar}. 

This \textit{noise} is inherent to most fighting games, since the enemy behavior, the game environment, the bot itself, or all of them, may have an
stochastic component which might make the result of a match vary from
one run to the next. Thus, different values would be returned
every time the fitness is measured by playing the game.

%% This issue arises in games due to the noisy and combat-based methods
%% used for the evolution of bots, because there is not a single,
%% principles-based way to compute the fitness, and thus, end the
%% algorithm.
Besides, independently of the approach you choose, it is usually impossible to reach a global optimum short of managing to obtain a bot that, as in Sun Tzu's ``Art of war'' \cite{tzu2013art}, is able to beat the opponent without
fighting, as the opponents are usually not known before the EA is running. 
% Antonio - esta frase no se entiende
% a menos que puedas ganar sin luchar, no puedes obtener el fitness
% óptimo - JJ
% Antonio - Yo esa cita la quitaría, aunque le dé un componente
% literario/gafapastiense al artículo. Tampoco veo por qué no se puede
% obtener un óptimo por no conocer al oponente antes de la
% evaluación. Si es un manta, le puedes ganar siempre...
% Afú. Es literario-gafapastiense-bromista. ¿Qué tiene de malo? - JJ
% Antares - A mi gusta xD
% Antonio - a mi no me molesta la frase, pero la referencia no hace falta, creo yo. ;D
% ¿qué hay de la segunda parte de mi comentario?
To solve this, usually matches with previously-known opponents are used in the
computation of the fitness function and an ``optimum'' is reached when a certain number of victories are achieved against them.
However, using only one or a small number of opponents may lead to
generate overfitted solutions that only beat the enemies that have
been used during the `training' phase (to compute the fitness)
\cite{DBLP:journals/jcst/MoraFGGF12}, and using more opponents might
make evolution unwieldy consuming too many CPU cycles. 

However, these two issues (noisy and reachability of optimal fitness)
are normally not taken into account when deciding when to end the
evolution process. and the usual approach is taking a
fixed number of evaluations or amount of time, usually given by the
game or challenge constraints (if it is in a competition). When this
rule is not imposed by a challenge or some other condition, this is
not the right approach for finding the best autonomous agent, or even
one that is 
good enough to defeat those that constitute the state of the art.

That is why finding the optimal termination condition is essential in the search for game bots that competes in a particular challenge. If there is not a fixed evaluation budget, the next usual solution is to give it as much as you have got, 
% Antonio - 'as you have got'??? En qué? A qué te refieres?
% ``darlo todo'' - JJ
which is fair if you are designing a bot %maribel, el got no se suele
                                %poner 
% Es coloquial y correcto gramaticalmente - JJ
to participate in a competition
\cite{DBLP:conf/cec/Fernandez-AresMGGF11}. However, from a
methodological point of view, if you want to compare different
approaches to design a bot it needs to be done in conditions that are
as similar as possible, which  
might make {\em as much as you have got} a bit short on
details: a independent stopping criterion is needed, since using any method for the same
time or for the same number of evaluations is not usually fair,
% Antonio - Explicar por qué no es justo.
because the object of the process is to obtain a very good or
near-optimal bot and some methods might need more evaluations, or more
time, than others. 
% explicado - JJ
This makes, from the methodological point of view, inadequate to simply use the
number of evaluations as a termination condition.

These three problems, two of them (noise and unknown or unreachable optimum)
algorithmic and one (fair comparison) methodological, are
common for most kinds of games, as well as for many other
problems without a known (or reachable) set of optimal solutions. In
this paper, we intend to pursue these issues by introducing novel 
termination conditions and comparing them with other classical
ones, and among themselves when trying to generate competitive bots
for videogames using Genetic Programming (GP) \cite{GP_Koza92},
because this method has proved to be quite flexible and has obtained
very good results in previous works \cite{EvoStar2014:GPBot:anon}.% Este no
                                % está en la bibliografía. Por favor,
                                % añadidlo a geneura.bib - JJ  
                                % Antonio - hecho

The game \textit{Planet Wars}\footnote{http://planetwars.aichallenge.org/}
% Antonio - poner una URL mejor que esta (la del campeonato), si se estima oportuno.
 has been chosen in our experimental setup, as it is a simple RTS (Real Time Simulator) combat-based game (only one type of resource, one type of attack and one type of unit), and also it has been widely used in the literature, using different generation methods and fitness functions 
\cite{DBLP:journals/jcst/MoraFGGF12,DBLP:conf/cec/Fernandez-AresMGGF11,DBLP:journals/nc/Lara-CabreraCL14,NogueiraCoevolutionary14}. This
game fulfills the two conditions mentioned above; initial position of
bots is random and the decisions are stochastic, although the result
of the combat is deterministic. 

Summarizing, our objective in this study is to find a stopping criteria that converges to good solutions (the optimal, if possible). %Maribel: Anadir al final de la frase, saving resources and time. 
% Antonio - he puesto 'optimal', pero no sé se dejarlo como 'best'
and that is independent of the method chosen. To measure the quality of every approach, we will 
consider the time (or number of generations) needed to obtain the
solution and the quality of that solution as metrics. 
% a ver, esto lo tenemos que pensar. 
% Vamos a poner un método como base: número fijo de evaluaciones, por
% ejemplo. A partir de ahí yo consideraría el número de evaluaciones
% adicionales y la mejora adicional al fitness. También el fitness
% absoluto, claro. - JJ
% Antonio - yo digo que el fitness (el usado durante la evolución)sea
% un mero indicador de lo buena que es cada solución, pero que eso se
% contraste con una evaluación final de los mejores individuos
% encontrados con cada criterio de parada. Es decir, cuando se tengan
% los mejores se ponen a luchar en muchos mapas contra muchos rivales,
% para decidir cuál de ellos es realmente bueno y cuál es,
% eventualmente o teóricamente, el mejor.
%Habrá que tener en cuenta también el tiempo, digo yo. - JJ
% Antares - Son tres métricas a ser consideradas: Bondad (fitness), Tiempo (Generaciones), tasa de finalización (no todos los SC han terminado en todas las ejecuciones). Sobre la bondad, se está ejecutando una batería de test en múltiples enfrentamientos :)

In general, and as pointed above, it is possible that the conclusions
could be extended to any problem solved via evolutionary algorithms
with an unknown or unreachable optimum and noisy fitness, since the
termination conditions chosen are independent of the game itself and
just take into account evolutionary measures. In fact, they could be
extended to any problem with the same characteristics.
% Antonio - además de esto, que hay que hacerlo para dejar la frase, hay que demostrar de forma 'impepinable' (más o menos) que lo que se propone funciona.

The rest of the paper is organized as follows. Next section
establishes the state of the art in the use of termination conditions
for this kind of evolutionary algorithms in which the optimum is not
known and/or with the presence of a noisy environment or fitness evaluation. Then in Section \ref{sec:met} we will %Maribel: quitar el will de la frase
present the different termination
conditions %maribel Borrar desde aquÃ­ hasta "and how ... " osea que la frase quedarÃ­a mucho mÃ¡s corta y sencilla "Next in Section \ref{sec:met} we present the different termination conditions and how they contribute to ...
we will be checking in this work and how they contribute to
prove which one has better behaviour in this context; we will also
sketch the problem we are using in this particular paper, evolution of
bot for Planet Wars. Results will be presented in Section
\ref{sec:res}, followed by the conclusions and a discussion of the
implication of the obtained results.
% Antonio - esto habría que reescribirlo mejor y con los contenidos reales. ;D


%maribel: En realidad, este Ãºltimo pÃ¡rrafo lo simplifiquÃ© y reescribÃ­ entero tal y como os pongo aquÃ­ abajo
%The rest of the paper is organized as follows. Next, section \ref{sec:SoA} establishes the state of the art related to termination conditions for evolutionary algorithms in which the optimum is not known and/or is noisy. Following, section \ref{sec:met} presents the set of termination conditions which have been checked in this paper and how they contribute to prove which one has better behaviour in this context; we also sketch the problem we have used in this particular paper, evolution of bot for Planet Wars. Results are presented in Section \ref{sec:met}, followed by the conclusions and a discussion of the implication of the obtained results.
% se puede usar este si falta espacio - JJ
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  STATE OF THE ART  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{State of the Art}
\label{sec:SoA}

Real world optimization problems often involve uncertain environment including noisy and/or dynamic environments \cite{Jin2005303,QianYZ13}.
Basic strategies to handle noisy fitness functions include using a larger population size, averaging to filter out the noise (re-sampling) \cite{Branke98,Branke2001}, thresholding (employing a threshold value to be used in a selection operator for noisy fitness functions) \cite{Markon2001} or changing the selection criteria.
Other authors propose complex methods such as including the multipopulation approach, special operators or case-based memory \cite{BhattacharyaIM14}. 

%--- Took out reference to our own paper, which should be taken out to the intro. I don't think anything above this is really relevant, other than referencing a very general paper that deals with noise (or our own paper at IJCCCI) - JJ


In \cite{merelo14:noisy}, Merelo et al. propose dealing with the problem of noisy fitness functions using two methods, the former based on re-evaluation of surviving individuals and the latter that uses a Wilcoxon test to compare a sample of individuals and partial-order them within the population.

% TERMINATION CRITERIA

As many EA depend on population diversity for its evolution, a termination condition given in terms of the rate of population diversity decrease would be useful. 
In this sense, Roche et al. \cite{RocheTermination13} propose terminating the evolution process by analyzing the EA population diversity. Thus, they presents a numeric approximation to steady states that is used to detect the moment that the population has lost its diversity for algorithm termination.


Usually, the algorithm termination is decided based on a heuristic stopping criteria, such as the maximum number of evaluations or on reaching a performance level during the run. 
When the algorithm converges, it is terminated in order to avoid wasting computational resources.
Although these criteria are suitable for well defined benchmark problems (the optimum is known), they are not applicable to real world problems. 
In these cases, more sophisticated heuristic stopping criteria have to be used \cite{NME2909,Wagner2009,Wagner2010}.

In the last years some adaptive alternatives have been proposed  as termination conditions.
In this sense, Safe et al. \cite{Safe2004} present a review of the state-of-the-art in the design of termination conditions and convergence analysis in GAs.
The main problem is determining an accurate value for the number of generations, so that the GA convergence is guaranteed.
Authors propose searching the minimum number of generations by means of a convergence analysis \cite{Rudolph1994}.


Finally, as stated in Hart et al. \cite{Hart1996} when calculating metrics of parallel performance, it is incorrect to stop a parallel EA either after a fixed number of iterations or when the average fitness exhibits little variation. In this case, stopping rules based on the attainment of thresholds should be used, i.e. stopping the run when a solution that reaches this threshold is found \cite{Sena2001}. Nevertheless, threshold definition requires a good estimation of the optimum of the problem under study, which is unavailable in many cases \cite{Safe2004}.

% A conclusion should be added to this based on the last paragraph - JJ
In this paper, several stopping criteria will be studied, considering the time needed to obtain the solution and the quality of that solution. 


%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  METHODOLOGY  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Methodology and experimental setup}
\label{sec:met}

This section describes, comments and justifies the different termination approaches to be tested in the paper. Although in this work we focus on a specific scenario (generation of competitive bots for the Planet Wars game), the results obtained could be, in principle, be applied to other similar problems. Therefore, we justify a general experimental and parameter setup, with the specific restrictions applied to the problem we are addressing. 

In this paper we propose different termination criteria that are based on different EA features, such as the parameters of the algorithm (maximum number of generations) or the population (improvement, replacement or age). 
% Antonio - no hay nada de diversidad
The differences in performance obtained with each configuration will be analysed and compared. 

% --------------------------------------------------------------

\subsection{Algorithm features}

 
% Cada vez que Antonio usa considered, Dios mata a un gatito - JJ
%In this paper, we use a generational approach [REF] in order to have a high level of diversity, % justificarlo
%which is better for checking some of the stop criteria to test. % ¿por qué? - JJ
%Specifically those population-based ones, which are normally more sensitive to diverse populations.
%maribel: Por qué es mejor tener diversidad para probar criterios de parada?, esto será mejor para algunos criterios, pero no para todos, de hecho los criterios de parada más utilizados, como el número de evaluaciones o el número de generaciones, no tienen nada que ver con la diversidad de la población. Sí es verdad que es importante para criterios basados en alguna metrica basada en la población, como el fitness medio en relación al mejor fitness, o criterios basados en algún tipo de distancia entre los individuos de la población, pero no para todos los criterios de parada en general, como parece que dice la frase anterior, así que creo que hay que justificar mejor el que el algoritmo sea generacional. Pongo a continuación una posible justificación a ver qué os parece.
% Antonio - Pos eso es lo que habia puesto yo. XD 
% Me has movido al frase en la que aclaraba eso mismo. Además de que desde el principio ponía 'some of the stop criteria'. ;D
% Esta frase no tiene sentido. - JJ

%The aim of this paper is to test which is the best way for stopping an evolutionary algorithm to find an autonomous and winner agent for playing a game. We have selected several stopping criteria, some of them, are controlled only by one or more evolutionary paremeter, but others by some features of the population. Due to this kind of stopping criteria, the diversity of the population should be preserved. For this reason, the generational approach is a good option for our test setup. 

%FERGU: He comentado la intro de arriba y he vuelto a escribirla abajo justificando por qué usamos el GP generacional

%The first step of the methodology requires to select the most adequate EA to the problem we are addressing. 
% Antonio - ¡Qué pesaos con lo de la metodología! Joé, que aquí la metodología va de elegir bien los criterios de parada, no de diseñar el algoritmo. Eso ya lo tendrá hecho el que vaya a usar nuestro método para elegir cómo/cuándo parar. :/
The aim of the implemented algorithm is to generate competitive bots from scratch (without human knowledge), so a Genetic Programming algorithm has been used. These kind of algorithms have been previously used in the generation of bots in videogames \cite{Esparcia2013GPunreal}. 
% Antonio - yo quitarí esta frase, o pondría más citas, una de dos. ;)

A \textit{generational} approach has been considered in the algorithm. 
% Antonio - ¿alguien sabe una cita de GP Generacional?
In it, at least half of the population (the best chosen as parents) remains from one generation to the next. This provides the algorithm with a higher exploration factor than a steady-state approach, which is very positive due to the huge search space of the problem we are solving.

%the lack of a known optimum solution, and the noisy feature of the problem, a generational GP algorithm will be used, with a specific scoring method as fitness.
% Antonio - Esto no tiene nada que ver con que se haya elegido un enfoque generacional. Vamos que no veo en qué ayuda eso... :(
% De hecho, para el ruido iría mejor un estacionario, creo yo.

A \textit{Score Function} has been proposed in order to measure the quality of a generated bot (a solution or individual in the algorithm). This scoring method tries to reduce the effects of the noisy evaluation (following the guidelines of other works \cite{DBLP:journals/jcst/MoraFGGF12}) by computing fitness from the result of 30 different matches against an expert rival.
Thus, the function considers the number of victories, turns to win and turns resisted before being defeated by the opponent (in the case of lose). The rival is \textit{ExpGenebot}, introduced in
\cite{DBLP:conf/cig/Fernandez-AresGMG12}, and based on the improvement of the heuristics proposed by a human player. This bot is, for this particular game, the state of the art. ExpGenebot adapts its behaviour doing an initial analysis
of the battle map and depending on the balance of forces between it and the enemy, i.e. location of the fleets and amount of ships.
This rival has been chosen due to its potential variety of behaviours,
so 30 different representative maps have been chosen for each
evaluation (30 matches, 1 match per map), to ensure the bot behaves in a different way in every match. Thus, the fitness evaluation enhances the value of an individual. 

Then, the fitness of each individual $i$ of the population is obtained using the next formula:
\begin{equation}
\mathbf{\boldsymbol{Score_{i}=\alpha+\beta+\gamma}}\label{eq:score}
\end{equation}

Where

\begin{equation}[H]
\boldsymbol{\alpha=v},\alpha\in\left[0,N\right]
\end{equation}


\begin{equation}[H]
\boldsymbol{\beta=N\times\frac{t_{win}+\frac{1}{N\times t_{MAX}+1}}{\frac{t_{win}}{v+1}+1}},\beta\in\left[0,N\right],t_{win}\in\left[0,N\times t_{MAX}\right]
\end{equation}


\begin{equation}[H]
\boldsymbol{\gamma=\frac{t_{defeated}}{N\times t_{MAX}+1}},\gamma\in\left[0,1\right],t_{defeated}\in\left[0,N\times t_{MAX}\right]
\end{equation}

The terms used are: the number of battles ($NB$) to test, the number of
victories of the individual against ExpGenebot ($v$), the total number of
turns used to beat ExpGenebot ($t_{win}$), the total number of turns when
the individual has been defeated by ExpGenebot ($t_{defeated}$) and the
maximum number of turns a battle lasts ($t_{MAX}$). This score aims to
favour the victories against the turns to win and turns to be
defeated, giving different ratios to each section. 
Therefore $\alpha$ has the highest ratio, the term $\beta$ adds an extra score taking into account the number of turns when the individual wins (lower numbers to win implies better bots), following a exponential curve; and finally, $\gamma$ adds a corresponding score from the turns to be beaten 
(higher number is better, as it is difficult to be beaten). The 
`1' in all denominators is used to avoid dividing by 0.

As previously said, each individual has been tested 30 times in different maps, therefore $NB=30$, and a the limit of turns is the default of the competition ($t_{MAX}=1000$).

The problem of using a tough rival as ExpGenebot is that the maximum fitness/score obtained during the evolution will be very limited, since it would be very difficult that a bot could win against 30 specialised bots \cite{Wolpert97nofree}. This is more evident if we take into account that the bots being evolved do not include any adaptive component that analyses the map, as ExpGenebot does. This fact will be seen in the fitness analysis in the following section.

%TODO FERGU: comentar y justificar el resto de parámetros del GP FERGU: hecho abajo
The used GP evolves a binary tree formed by {\em decisions} (logical expressions that evaluate the current state of the game) and {\em actions} (the leafs of the tree: the amount of ships to send to a specific planet). This tree is evaluated in each player's planet, analysing the current state of the map/planet (decision), and how many ships send from that planet to an specific target planet (action). These target planets can be the wealthiest, the closer one, etc. owned by the player or the enemy, or neutral. The possible actions and decisions are listed in \cite{EvoStar2014:GPBot:anon}. Table \ref{tab:parameters} summarizes the rest of the parameters of the EA. These parameters were also justified in that paper, obtaining competitive bots.

\begin{table}
\begin{center}
\begin{tabular}{|c|c|}
\hline
{\em Parameter Name} & {\em Value} \\ \hline
Population size ($N$) & 32 \\ \hline
Number of battles for scoring ($NB$) & 30 \\ \hline 
Re-evaluation of individuals & Yes \\ \hline
Crossover type & Sub-tree crossover \\ \hline
Crossover rate & 0.5\\ \hline
Mutation  & 1-node mutation\\ \hline
Mutation step-size & 0.25 \\ \hline
Selection & 2-tournament \\ \hline
Replacement & Generational\\ \hline
Maximum Tree Depth &  7 \\ \hline
Runs per configuration & 30 \\ \hline
\end{tabular}
\caption{Parameters used in the experiments.}
\label{tab:parameters}
\end{center}
\end{table}

% Antonio - @Fergu, @Antares. Cuidao con los nombres de los parámetros. Ponle un nombre al número de individuos (a la variable o parámetro) y usa ese mismo nombre debajo, en el criterio de Tasa de Reemplazo, porque se ha puesto 'N', que es el número de batallas en la fórmula del Score. Yo pondría otra variable allí, BTW, por ejemplo 'NB'. Así no hay líos. ;D FERGU: Cierto, NB es mejor, puesto.



% --------------------------------------------------------------

\subsection{Termination Criteria}
% Antonio - Maribel, criteria es el plural de criterion. ;)

The traditional set of stopping criteria are either based on stagnation, checking for the existence of a solution in the set and a fixed budget. Combining them we have designed a set of five different algorithm stop criteria which are going to be checked in the paper, namely:

\begin{itemize}
    \item \texttt{[NG] Number of Generations}  is the classical termination
      criteria in evolutionary algorithms. We will consider 30, 50, 100 and 200 generations since some papers \cite{EvoStar2014:GPBot:anon} have mentioned the middle value. As indicated in the previous section,
      Hart \cite{Hart1996} claims that this is not the right way to
      compare different approaches; however, we include it here as a
      baseline for comparison with the other approaches. % En ese caso yo creo que no habría que probar tantos valores diferentes.

    \item \texttt{[AO] Age of Outliers}: if the age of one individual is an outlier in the comparison with the rest of the population then it would be potentially an optimal solution and the algorithm can be stopped. % why?
The idea behind this criterion is that an individual surviving for several generations more than the rest of the population lead to be a very good player (much better than the rest), and thus, a potential optimal solution for the problem. The difference between the age of the outlier and the rest of the population is measured considering three factors: 1, 1.5, 2 and 2.5 times the interquartile range (IQR). %explain a bit. Does this mean that it will stop when it finds somebody that is two times as old as the average? - JJ
% Antonio - @Antares, explica esto, que no me quedó claro lo de la IQR... :D

    \item \texttt{[RT] Replacement Rate}: when using an elitist strategy in which individuals are replaced only if the offspring is better, the fact that the population stops generating better individuals might be a sign of stagnation. Four different rates have been tested, namely $\frac{n}{2}$ (50\%) , $\frac{n}{4}$(25\%), $\frac{n}{8}$(12.5\%), $\frac{n}{16}$(6.25\%) ... % but this has to be combined with a steady state approach or something. By itself, it does not mean a thing. Please explain - JJ
% Antonio - en la descripción del algoritmo se habrá dicho que va a ser generacional (hecho), ya que en un estacionario la tasa de reemplazo estaría mucho más acotada. ;)
% Maribel: En un algoritmo generacional clásico, se reemplaza toda la población con los hijos menos el mejor. Pero nosotros no estamos usando este reemplazo, así como así, sino que hacemos unión de los hijos y los padres y nos quedamos con los mejores N no? Si esto es así, sería una cosa a comentar en la sección de GA features.
% Antonio - efectivamente, he intentado contarlo mejor debajo. En todo caso hay que aclararlo en la descripción del algoritmo. - TODO -
% Aquí había que haber hecho una aclaración o referencia al mismo. Ya lo he aclarado - JJ
   The values are based in the maximum number of replacements per generation. Our model defines a maximum of $n = N/2$ individuals to be potentially substituted by the offspring. Thus, the parameter values aim to test half of this probability, and half of the previous values, respectively.
% Antonio - @Antares, cuidao con la variable 'N', que es el número de batallas en la función Score...

    \item \texttt{[FT] Fitness Threshold}: a maximum value to obtain in the evolution could be set considering the top limit of the score function, 45. However, that value is a limit and never reachable unless the bot wins all the matches in just one turn (when the rival code makes a critical error and cannot be run). This, along with the toughness of ExpGenebot, makes the real fitness limit close to 40 instead. Thus, five thresholds have been defined taking this maximum value ($MAX_{SC}$) as a reference, namely: 20 (as half the maximum: $MAX_{SC}/2$), 30 (as half the maximum score plus half this value: $MAX_{SC}/2 + MAX_{SC}/4$), and the division in four parts of the interval these values compose: 22, 24, 26 and 28.

The justification of these values to check is related with the noisy nature of the fitness/score function, which leads us to think that the improvements of fitness will be very limited (very short steps will be attained in the evolution in the range of the high scores).
% Los valores son bastante arbitrarios, pero bueno. 
% Antares - ¿Esto no lo habías cambiado tú? ya no son estos :(
% Antonio - el que comenta es @JJ, no yo. :P
%           Ya lo he cambiado, intentando justificar esto, pero weno, es un poco chungo...
In general, setting a fixed value that is a certain distance away to a known (and maybe unreachable) optimum is a compromise solution, since it is not known in advance whether this lower level will be even reached and, if it is, what would be the effort needed to go beyond that and whether a better solution (even including noise) could be found with a higher value. 
% En este caso, ¿no se tiene en cuenta el ruido? - JJ
% Antares - Si se contempla el ruido, ya que se sigue haciendo re-evaluaciones. 

    \item \texttt{[FI] Fitness Improvement}: in an ideal evolutionary process the fitness of the best individual must be improved every generation. However, the noisy nature of the problem (or the noisy fitness function) makes this difficult to be measured. Thus, the idea of this criterion is that if the best fitness is not improved during a number of generations, the algorithm must stop. Four possible values will be tested: 3, 7, 10 and 15 generations. %maribel y por qué estos? está fijado antes en algún otro paper como el del número de gneraciones?
These values have been set after a dedicated systematic experimentation phase, thus they are the minimum and maximum thresholds plus two intermediate values. These values would be strictly related with the problem difficulty so in order to set them in other cases an experimental process should be done to test the fitness variability or improvement rate per generation.
% Antonio - aclarado. Es la más difícil de justificar. 
% JJ - yo probaría más valores. En todo caso, el fitness variará cada generación si se vuelve a ejecutar, ¿no? 
\end{itemize}

The first stop criterion is based in an algorithmic parameter, so the algorithm stops when this parameter reaches a value. For this criterion, the population status does not matter. The rest of criteria are population-based ones, i.e. they consider some of its features to test if the algorithm must stop. The feature of the population leads the stop criteria and so leads the end of the algorithm. 

All these criteria will be tested in the following section. The objective of the experiments conducted is to choose the best stop criterion among all the proposed, and even more, the best value to set on that criterion, depending on the problem to solve and on its features: noise, difficulty, computational limitations, or performance restrictions.

% is to test the set of termination criteria... %el objetivo no es nunca ``probar'' esto. Es solucionar un problema. 

% Habrá que decir qué se va a medir y por qué. ¿Qué se compara? ¿Por qué?
%
%%%%%%%%%%%%%%%%%%%%%%%%%%  EXPERIMENTS AND RESULTS  %%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Experiments and Results}
\label{sec:res}

The experiments conducted have involved 30 runs, each of them configured including all the defined stop criteria, and also adding an extra termination one, i.e. getting to 500 generations, in order to avoid non-ending runs.
Thus, in every execution all the criteria are checked in every generation and, whenever one termination condition is met, the best individual to that moment (according to its score) is stored as the optimal solution for that criterion.

Once all the runs have finished, we compute the average number of generations and the average score obtained for the same criterion in different runs. There could happen that one criterion is never met in a run, then this will not be considered in the computation of that value.

This is an issue due to the toughness of the rival and the presence of noise ***



% Antonio - @Antares - La Figura 1 está mal. Los boxplots no se corresponden con los títulos y la leyenda del eje X. ;)

\begin{figure}
\begin{center}
\includegraphics[width=\columnwidth]{imags/Boxplot_SC-Score-log.eps}
\end{center} 
\caption{Best individual score (of all runs), grouped by termination criteria.}
\label{fig:boxplotscore}
\end{figure}

% Antonio - @Antares - La Figura 2 está mal. Los boxplots no se corresponden con los títulos y la leyenda del eje X. ;)

\begin{figure}
\begin{center}
\includegraphics[width=\columnwidth]{imags/Boxplot_SC-Generations-log.eps}
\end{center} 
\caption{Generation attained (of all runs), grouped by termination criteria.}
\label{fig:boxplotgenerations}
\end{figure}

% Antonio - @Antares - La Figura 3 se podría mejorar: Me gustaba más sin la escala logarítmica, se veían más claras las diferencias. Los textos se ven mejor al no solaparse, pero por contra los puntos (que son lo más importante) son difíciles de ver, con lo que queda menos claro qué método es mejro y por cuánto. También es difícil apreciar las oscilaciones que se producen (lo que os comenté en los comentarios del Issue). Por otra parte la imagen es un poco tocha. XD

\begin{figure}
\begin{center}
\includegraphics[width=\columnwidth]{imags/Comparative-log.eps}
\end{center} 
\caption{Mean best individual score versus mean attained generations by each termination criteria.}
\label{fig:comparative}
\end{figure}


% Antonio - @Antares - Pregunta general. ¿por qué los valores en las gráficas llevan un decimal '.0' si son enteros? ¿No estarían mejor sin él? ¿No quedaría más claro al haber menos texto? :D

% \begin{figure}
% \begin{center}
% \includegraphics[scale=0.4]{imags/ScoreBest-Evolution.eps}
% \end{center} 
% \caption{Evolution of the fitness of the best individual during time.}
% \label{fig:scorebestevolution}
% \end{figure}

% \begin{figure}
% \begin{center}
% \includegraphics[scale=0.4]{imags/ScorePopulation-Evolution.eps}
% \end{center} 
% \caption{Evolution of the average fitness of the population during time.}
% \label{fig:scorepopulationevolution}
% \end{figure}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  CONCLUSIONS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\section{Conclusions}

%% En las conclusiones no debemos olvidar sentar las bases de los tipos de problemas/algoritmos a los que se podrían extrapolar o generalizar los resultados.

%% - fitness óptimo no conocido
%% - ¿entorno ruidoso?
%% - que se usen mecanismos para paliar la influencia del ruido es importante (podría ser requerido)
% No se usa ningún mecanismo para ``paliar'' el ruido. Sí se intenta trabajar con él.
% Antonio - ¿Se podría comentar también que alguno de los criterios de parada podría
%ser empleado para algún mecanismo diferente del algoritmo, como un
% ``cataclismo'' o una variación de los pesos o algo así? 

\section*{Acknowledgements}

Hidden for double-blind review


\bibliographystyle{splncs03}
\bibliography{geneura,references,gpbot,genebot}

\end{document}
