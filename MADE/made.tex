\documentclass[runningheads,a4paper]{llncs}

\usepackage[latin1]{inputenc}
\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{subfigure}

\usepackage{url}
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\begin{document}

\mainmatter  % start of an individual contribution

% first the title is needed
\title{World building: analysing the parameters for massive evolutionary generation of coherent backstories in fiction environments} 

% Antonio - yo pondría 'evolutionary' en lugar de 'evolutive'. He
% cambiado 'fiction' a 'fictional' que es adjetivo, creo que está
% mejor. ;)
% fiction = de ficción Fictional = ficticios. Pongo como
% estaba. Evolutionary puede que sea mejor que evolutive, pero tampoco
% hay tanta diferencia - JJ

% a short form should be given in case it is too long for the running head
\titlerunning{World building: analysing the influence of parameters}

% the name(s) of the author(s) follow(s) next
%
%
\author{A. N. Onymouse%
\thanks{Anonymous Institute}}
%
\authorrunning{Anonymous, A}
% (feature abused for this document to repeat the title also on left hand pages)

% Antonio - he cambiado el autor y demás para que no sea el mismo que el de GPBot. :D

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{No Institute}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the document class "llncs.cls".
%

\maketitle


\begin{abstract}
Generating fictional worlds for a 
% <RH>expongo el problema concreto ya que en esta misma frase hablamos de fitnes
	multi-agent system optimized by means of genetic algorithms
% </RH>
(with some specific requirements
%<RH>
	related to the desirable plots),
%</RH>
presents two main problems: first it is impossible to know in advance the optimal value for the particular designed fitness function, and at the same time, it creates a vast search space for the (evolutionary) 
 % TODO: <RH> Y no solo evolutionary, pero se si liar mas el abstract</RH>
parameters that it
needs. The purpose of this paper is to define a methodology for finding the
best parameter values for both, the evolutionary algorithm, and the own fictional world configuration ones.
% TODO: <RH>Y no solo evolutionary, pero se si liar mas el abstract</RH>
This evolutionary design includes running, to completion, a world simulation represented as a chromosome, and assigning a fitness to it, thus composing a very complex fitness landscape.

% <RH> reescribo esta oracion
	%That is why, in order to
	%optimize resources given to evolution and also have some guarantee
	%that the final result will be close to optimal, we systematically
	%study the values of different parameters to try and find a set of
	%rules that will, once you have the fitness function, help you set a
	%reduced range of values or even a single value that will, with a
	%reduced computation budget, help you find an optimal world.
In order to optimize the resources devoted to evolution and to have some
guarantees that the final result will be close to the optimum, we systematically
analyse a set of possible values of the most relevant parameters, obtaining a set of generic rules. 
%FERGU: analyse es británico y el Evostar es europeo
% Antonio - ¿a qué te refieres por regla?¿qué tipo de reglas?
% Rubén - a reglas que debe seguir un autor para que que el entorno ofrezca los mejores resultados para él o
% las reglas que debe tener en cuenta quien diseñe una solución similar. No se si queda claro tal y como está explicado.
These rules, when applied to the plot requisites, and thus, to the fitness function, will lead to a reduced range of parameter values that will help the storyteller to create optimal worlds with a reduced computation budget.
% </RH>

\keywords{Games, Plot, Content generation, Fictional world, Literature, Evolutionary algorithms}
\end{abstract}

\section{Introduction}

In the very competitive cultural industry that includes videogaming, writers rack their minds in
order to generate interesting fictional worlds.
% Antonio - no creo que la mayoría de autores se centren en idear
% mundos para videojuegos (por desgracia). :D
% Antonio, por favor, si escribes algo escríbelo bien. "including for
% the" está mal escrito. Si no está seguro, sugiere cambios - JJ
In order to make the generation of these fictional worlds and the stories within them truly believable, efficient and massive, several automatic/autonomous methods have been proposed  \cite{garcia:anon,nairat2011character}. One of 
% Antonio - He puesto la REF de Nairat. Comprobad que es la correcta. ;)
them, called MADE 
\cite{garcia:anon} finds ``interesting'' character stories by running
% Antonio - creo que no hay una norma para usar comillas simples o dobles, pero lo que yo suelo ver es que si se habla de términos específicos se usan comillas simples y si es un texto (un string) se usan las dobles. Es sólo una propuesta. ;D
an evolutionary algorithm that optimizes a fitness function designed to better fit with the archetypes which the user desires they emerge in the world that he/she is designing.

MADE works as follows: every individual in the evolutionary algorithm
is described by a chromosome that represents one (or several kinds of)
finite state machine (FSM)\cite{FSM_Booth} that are set to `live' (interact) in a simulated environment. The evolutionary algorithm was run with a standard
parameter configuration, meanwhile {\em sensible} non-evolutionary parameters were assigned default values. The latter are variables such as the number of profiles needed to obtain the desired result, or the size of the simulated
world. There was no attempt to optimize these parameters, since the
main intention seemed to be to have a prototype that allowed the
authors to have an acid test of their proposed approach.

That paper hinted at the fact that parameters such as the number of
{\em profiles} (different types of finite state automaton present in
the world) had a big influence on the outcome, to the point of making
it possible or not. However, other parameters such as the number of
simulated days the world is running might also have influence, but the authors did not conclude to which level.

In this paper we will use that open source simulator 
% Antonio - poner el enlace. Se supone que no es 'nuestro'. Vamos, que
% no afecta al blind process. ;)
\footnote{Which can be downloaded from Github at (hidden URL)}
%hecho - JJ
 and look at it from the evolutionary point of view so that we can check what kind of influence the configuration variables have in the outcome. We will do an experimental setup that will test different parameters (evolutionary and non-evolutionary), and eventually find a series of rules that will help the users of that framework to set the best values for their simulation (depending on their requirements or constraints).

% Antonio - Le falta chicha a la intro. Propongo describir un poco mejor el proceso que se va a seguir para estudiar los parámetros y su influencia, así como para crear esas reglas.

The rest of the paper is organized as follows. Coming up next, we
present the state of the art in parameter setting of simulated
worlds. Next we will present the experimental setup we follow in this
article, whose results will be shown in Section \ref{sec:res}. Finally, we will
present the conclusions reached in this paper.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{State of the Art}
\label{sec:sota}
%TODO revisar toda la seccion, de momento estoy poniendo la info mas o menos redactada pero falta la coherencia

% Esto está copiado del de Alife y además, no viene muy a
% cuento. Habría que hacer un resumen y decir "esto es un PCG de tal y
% tal forma" y punto. - JJ
According to the taxonomy described by Togelius et al. \cite{togelius2011search}
the problem of massively generating backstories for non-player characters (NPCs) mainly has the following flavours:

\begin{itemize}
\item{\textit{Procedural content generation (PCG)}}: 
The problem implies the automatic creation of a whole world with its
characters, relations and plots.
\item{\textit{Stochastic}}: The generation is stochastic for every game run, enabling the reuse of the tool and the replayability of the game in the future.
\item{\textit{Offline}}: The generation (and optimization) has to be performed during the game development, i.e. the phase used to design the plots.
\item{\textit{Search-based}}: The system is optimized with a generate-and-test algorithm that will start from a set of solutions and will test small improvements to reach an optimum. For this purpose, a genetic algorithm is frequently used.
\item{\textit{Optional}}:  The content (world, backstories) is not essential for the main plot but it contributes to the realism of the user experience.
\end{itemize}
% Antonio - esta taxonomía no me cuadra mucho. La PCG (apartado 1) puede hacerse mediante algoritmos de búsqueda u optimización, como los AEs (otro de los apartados). Por otra parte éstos podrán ser offline (otro apartado) y el contenido a crear podría ser opcional o completo...
% Yo explicaría todo esto sin ponerlo a modo de taxonomía, sino comentando las distintas opciones de PCG: basada en algoritmos de búsqueda u optimización o de forma estocástica, que se puede hacer online u offline y que puede generar historias completas o parciales. Por ejemplo. ;D

% Antonio - creo que podríamos poner algunas citas a los tipos de PCGs, con algunos ejemplos de cada tipo (o uno, al menos). Así quedaría más completa la sección. ;)

In this context (massive non-interactive goal-driven plots), different
approaches has been proposed, following the survey
\cite{arinbjarnar2009critical} by Arinbjarnar et al.:

% Antonio - todo esto son métodos automáticos, ¿no? 
% Hechos mediante programas o algoritmos en computadores, ¿no? Dejadlo claro. ;)

In 1976 the program called \textit{Tale-Spin} \cite{meehan1976metanovel} was able to produce
% Antonio - Tale-Spin era un programa, ¿no?
purely text-based fairy tales where semi-autonomous characters
showed emotions and relationships, with the shortcoming of creating very inconsistent plots.
Then, different researches used the concept of \textit{goals and pre-defined
stories} to construct stories: In 1987, UNIVERSE \cite{lebowitz1985story}
was used to create infinite soap opera style stories driven by
goals provided by the author. It used fragments of stories to assign
roles to stereotypical characters, relying on the reader the assumption
of the characters' motivations.
In 1994, Turner created Minstrel \cite{turner2014creative}, a program which used 
% Antonio - Minstrel era un programa?
case-based reasoning to generate stories about knights and ladies by replacing variables in existing stories and recombining them. It also used goals, in this case for the story and for every character. In 2008, Riedl and Leon
 used in \cite{riedl2008toward} the same idea, conceptualizing a vignette
as a small story assumed as ``interesting'', thus they can compose complete stories when exposed sequentially.

The technique applied in this paper can be understood as the evolution of
these researches adapted to massive worlds, where coherence is provided by the use of an Agent-Based Model (ABM for further references).
Instead of using ``vignettes'' to construct stories, our approach
modifies the behaviour of the agents and finds ``archetypes'', i.e. behaviours and patterns universally accepted and present in the
collective imaginary \cite{garry2005archetypes} that could be interpreted as
generic ``vignettes''.

The idea of emerging plots from agents' (ABMs) interactions is not new:
In 2007, Virtual storyteller \cite{swartjes2007emergent}, used agents that improvise using techniques from improvisational theatre, a plot guide and a narrator. Our technique uses the same approach but there is no plot guide agent. Instead, a Genetic Algorithm will guide the mood of the backstories created by finding ``archetypes''.
% Antonio - desired archetypes?

The search of a good plot can be addressed from the Evolutionary Computation (EC) point of view. To this aim in 2011, Nairat et al. proposed in \cite{nairat2011character} a generative drama approach
that integrates human creativity by using an agent-based system where
the characters are developed using interactive evolution. One year later, 
Cioffi-Revilla et al. \cite{cioffi2012evolutionary} published a study that
applies a combined EC-ABM approach to the challenge of understanding
complex adaptive systems in social science. Their conclusions suggest further applications of EC to ABM in terms of multi-population models with heterogeneous agents, multi-objective optimization, dynamic environments, and evolving executable objects for modelling social change. %FERGU: modeling es americano

Our approach relies on this idea by using a Genetic Algorithm (GA) to 
obtain the agents' behaviour that better fits the goals described by the user/author before the world is generated.
% TODO @raiben enganchar mejor este último párrafo
% Antonio - hecho. ;D
It follows the methodology presented by García-Ortega et al. in \cite{garcia:anon}. They systematized the generation of backstories in massive worlds by means of GAs. Thus, the steps to define the elements of a complex world, and how to optimise their character's behaviour using GAs to extract information, were presented.
Moreover, that work included a preliminary analysis of one parameter: the number of profiles. 
% Antonio - profiles generados? o qué profiles?
Results in that paper shown that this parameter have a significant influence
in the archetype-based fitness attained. The open-source simulator 
MADE, 
% Antonio - URL como nota al pie o algo FERGU: puesta
% Quitado porque ya se ha puesto antes - JJ
used in the present work, was also introduced in that paper. However, the rest of parameters that conform the fictional setting (defined in 
\cite{morrell2006between}) were set as standard ad-hoc parameters. 
% Antonio - He puesto la REF de Morrel. Comprobadla. ;)

In this paper, we want to extend that study testing the rest of the parameters that model a story: the time, the world, the characters and the leitmotif.
% Antonio - hay que darle muuucho más bombo a esto. La importancia de los parámetros, que los resultados pueden variar mucho con un cambio leve en ellos, que unos tienen mucha más influencia, que otros podrían resultar superfluos, que hace falta hacer este estudio para definir el algoritmo bien, que se va a hacer una definición de reglas de configuración, etc etc.
% Este es el 'selling point' y hay que venderlo bien. De lo contrario puede parecer que esto es una mera excusa para publicar algo sin mucho esfuerzo (aunque lo conlleve, claro). ;D
% Todo esto también habría que recalcarlo en la Intro. Incluso de forma más extensa que aquí. Si se hace en aquella sección, aquí sólo se nombraría lo que se va a hacer con una pequeña justificación. ;)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Methodology} %Issue #12
\label{sec:met}

As mentioned in section \ref{sec:sota}, the proposed technique for generating fictional worlds 
relies in the use of a a combined EC-ABM approach (a GA in this case).
The fitness function is configurable to fit the story needs,
Then, some parameters have to be fixed: world constants, agents' constants and genetic algorithm parameters.
Finally, the GA has to search in a noisy space, due to the stochastic nature of the approach.
The influence of each constant and parameter is, a priori, impossible to predict.

Our methodology systematizes the study of key parameters in the massive generation of backstories with 
EC-ABM approach
% Rubén - OJO, desde ``in order'' he repetido frase del abstract y probablemente no deba hacerlo.
% Si a alguien se le ocurre como cambar la frase u opina que deba quedar fuera, que actue
in order to optimize the resources devoted to evolution and to have some
guarantees that the final result will be close to the optimum.



\subsection{Problem characterisation}
\label{subsec:idio}

% Rubén - Las listas ocupan mucho espacio, pero son tan claras... en todo caso, que alguie con más expertise me diga si lo cambio por párrafos hilados.
This methodology is addresses to problems that present the following characteristics:
\begin{description}
\item[Goal:] The final goal is to generate stochastic virtual worlds massively inhabited by characters with backstories that are aligned with a mood defined by the writer.
\item[Virtual world:] The virtual world is created by the ABM.
\item[Fitness:] The virtual world can be evaluated depending on different taxes of archetypes (set by the writer) found in the characters that inhabit it.
\item[Archetype:] The archetype is a behaviour patterns that can be present in a backstory.
\item[Backstory:] The backstory of a character is a set of actions and interpretations, coherent with the virtual world and the other agents.
\item[Agent:] The agent represents a character that performs actions in the virtual world depending on the neighbourhood and its internal state.
\item[Profile:] The agents can be parametrised and their behaviour (probabilities to perform actions) depends on these parameters. The profile (S) is the set of values for these parameters and can be optimized by the GA.
\item[Conflict:] Every action is performed in a place and a time, affects to one or more agents and relates to a leitmotif.
\item[Place:] The agents occupy a location in a map. The map is defined by its size (W).
\item[Time:] The world exists during a period of time (D). Every backstory will be fed by actions as time goes by, in a bottom-up approach.
\item[Leitmotif:] In this context, the leitmotiv (F) can be considered as the source of conflicts between the agents; the element that the agents compete for.
\end{description}


\subsection{Parameter effects}
\label{subsec:params}

As Morrell explains in \cite{morrell2006between}, ``Fiction has three main elements:
plotting, character, and place or setting'', so, intuitively, these three elements can affect the backstories:

In our problem, the agent is affected by its profile, that defines its behaviour.
Our technique uses the GA to evolve the profile of the agent,
so it will be part of the search space.
Nevertheless, the use of different number of profiles (S) may also affect the behaviour of the agents, since more profiles
in the same world can imply new type of conflicts.

The plotting is the result of the different conflicts, that are affected by the place,
the time and leitmotif.

The place is defined by the size (W). Smaller maps usually implies more friction between the agents,
thus different variations of S may derive in different behaviours. The values that should be chosen
are those that test a size smaller or equal to the neighbourhood defined (letting all the agents
access to all the resources and positions of the world), a size bigger than the neighbourhood
(forcing the agents to move to reach a new neighbourhood) and much bigger (showing the effects
of having a big inhabited world).

The time of the conflict is affected by the period of time that the world will exist (D).
In this sense, a longer period of time will usually imply more interactions, \textit{ergo} more
archetypes and better fitness, and eventually more agents in the world. In the other hand, the evaluation
of an individual in the GA implies the execution of every agent and the evaluation of each backstory,
thus more agents and bigger backstories can increment significantly the evaluation time.
The values proposed for the study vary from a very short period of time to a bigger one, where the
maximum is the agent's average lifetime.


The leitmotiv is modelled with the parameter (F). Changes in this parameter can increment or decrement
the number of interactions.

Finally, the search space can be affected by the GA parameters. In this sense, the most significant
parameter is the population (P), since bigger populations will provide more accuracy but spend more execution time.

To sum up, our methodology will systematically combine more than two variants os five parameters
and study how the fitness is affected. The parameters proposed for the problems characterised in
subsection \ref{subsec:idio} are the number of profiles (S), the world size (W),
the virtual time (D), the leitmotiv (F) and the population of the GA (P).
Three variants for each of the five parameters implies 243 combinations of parameters
that have to be evaluated by the GA at least 30 times to obtain statistically significant results.
The total amount of executions should be at least 7290.


\subsection{Problem specification}

%Rubén - Empecé a escribir esto, pero creo que tal y como lo explica FERG es más literario

%MADE's instantiation of the problem show the following characteristics:
%\begin{description}
%\item[Fitness:] Different archetypes can be chosen.
%\item[Agent:] A rat that 
%\item[Place:] The agents live in a grid square (map).
%\item[Time:] The world exists during a period of time (virtual days).
%\item[Leitmotif:] The agents are programmed to survive. In our problem, the hunger is the source of conflicts.
%\end{description}

%MADE's instantiation of the problem shows the following characteristics:

%Initially, the fitness should be defined considering the desired behaviour
%for the agents that populate the world, for example, aiming to reach given quantity of some archetypes. Thus,
%In order to enable the generation of different
%personalities, different number of ``profiles'' would be required. This concept,
%presented in \cite{garcia:anon}, describes the different sets of behavioural
%parameters of the agents in the world (the number of different
%FSMs). Therefore, a world with three profiles is composed by three different
%types of agents. However, as it was demonstrated in that work, the
%number of profiles could be different of the number of desired
%archetypes, as some archetypes can be shared, or on the contrary, impossible to obtain with a certain \textit{number of profiles}.
%For this reason we have added this parameter to the list to study in the present paper. 

% Is this the main point of the paper? Wasn't this proved
% in the alife paper? - JJ FERGU: you are right, changed


% Rubén - Resumen de MADE con lo básico para centrar al lector y hablar sobre números que luego son referenciados
% Considero que esto puede recortarse pero que en esencia estos párrafo explican conceptos de MADE que se van desgranando a lo largo del paper 
% sobre todo lo relativo a cifras sirve para explicar el experimental setup.
% (que nunca se ha dicho en otros papers y de hecho está bastante resumido)

The agent in the MADE world is a representation of brown rat
modelled as a finite automaton that performs actions like move, eat, attack,
defend, escape, find mate or have offspring.
In general, these agents are considered as adults at the age of 40 days, have a pregnancy
period of 30 days and die at the age of 300 days, but those values can vary depending on
the profile (or set of parameter values that define the rat behaviour).
The place where the conflicts appear is a square grid. A cell can only be occupied by one agent.
Each agent can move and interact with other agents in a neighbourhood of 7x7 cells whose center is its position. 
The time is instantiated as ``virtual days''.
The leitmotif of the rats is to survive and to have offspring, thus the source of conflicts is the food:
agents attacks themselves to steal food before it is eaten by
other agents. Systematically, a number of food rations appears in random positions in the map every virtual day.
An agent can die of hunger, due to the damage inflicted by other agent or
because of its advanced age.

% Rubén -OJO: importante, no borrar porque es el único lugar donde explico los 3 arquetipos de los que luego se
% sacan conclusiones (y además, muy cortico)
MADE lets the writer select different archetypes that can be promoted in the world
as described in \cite{garcia:anon}.
In this paper we will focus on three different archetypes that will be studied: An agent
is considered a \textit{villain} if it kills other agent as a result of a fight for the food,
a \textit{hero} if it attacks a \textit{villain} and
\textit{avenger} is it attacks other agent in revenge.

% Rubén - Aquí explico el dichoso fitness, que nunca queda bien claro. Espero que ahora ...
The fitness of the world is a function of the sum of the value for each archetype rate, i.e. 
the number of characters that present the archetype divided by the total number of characters.
To promote the appearance of all the archetypes, avoiding as much as possible the 
starvation of any of them, the function presents a logarithmic curve where
small rates get bigger values. As a consequence, the fitness of a world with a
presence of two archetypes whose rate is 0.25 is bigger than the fitness of a world
with one archetype whose rate is 0.5.
The function used by MADE is described as the following formula: 


%The first step requires to develop a fitness function that takes into
%account the quantity of the desired archetypes. This fitness function
%should enable the existence of diversity in the desired
%archetypes: that is, it is better that the world has 25\% of
%``villains'' and 25\% of ``heroes'' than 50\% of ``villains'' and no
%``heroes''. Thus, we propose the following fitness function: 

%TODO Una vez mas, no usais ninguna metodologi­a para hacer esto. Es un poco ``Se me ha ocurrido hacerlo asi­''. - JJ FERGU: como podemos hacerlo?
% RUbén - espero que quede explicado con lo de arriba


\begin{equation}
F_A= {\sum _{i=1}^{A} {\log \left( 1+10r_{i}\right) } \over {\log 1}}
\end{equation}

where $A$ is the number of archetypes that take part in the fitness, $r_{i}$ is the
appearance rate of the archetype $i$ in the world ($r_{i} \in \{ 0 , 1 \}$).

% Rubén - Quiero añadir que max(F_A) = A, es decir que si se usan 4 arquetipos, el máximo es 4.
% Si alguien sabe cómo expresarlo, que lo añada al párrafo de arriba, please

                                % Why logs and all the rest? - JJ 
                                % FERGU: TODO @raiben hablar de arquetipos y completar lo de abajo
                                % Rubén: OK, explicado arriba


\subsection{Data analysis}

%TODO 


\subsection{Converting logs to stories}

Once the best values of the parameters have been found, the system can be run
inside a game context to generate a whole set of secondary characters.
For the simple reason of using agents in a bottom-up approach for the world generation, MADE provides a social network with family relationships, but also other related to the disputes and to possible archetypes, i.e. in our study, a ``hero'' fights a ``villain'' or an ``avenger'' takes revenge on other character.

The storyteller will be able to tell a story about each character by accessing to its lifelog. The lifelog should have a pre-defined format understandable by the storyteller, with fields like the date, the action performed, the internal state, the direct object and the indirect object.
Moreover, each agent should be tagged with the different archetypes it fulfils, the days that this archetype begins and ends, and the agents affected.

With this information within reach, the storyteller can create a story about the character by narrating its birthday, its name, the name and story of its parents, siblings and children (also using this technique for describing them), what the agent is (as archetype: ``vilain'', ``hero'', ``avenger'') and why (dates, characters related and supposed motivations).

% Rubén - pondré una referencia a la sección de resultados donde contaré en una líneas una historia de ejemplo generada en un mundo ejecutado con nuestros parámetros.

\section{Experimental setup}

% Rubén - Si hace falta hueco qutamos este párrafo, que básicamente
% repite lo dicho
% Has explained!!! Agh!!! Mis ojos!!! - JJ
As explained in subsection \ref{subsec:params}, the parameters 
whose effect will be studied are the number of profiles (S), the world size (W),
the virtual time (D), the leitmotiv (F) and the population of the GA (P).
Different parameter values for each element will be studied to clarify
their influence in the literary world generation, following the rules and 
recommendations present at the subsection \ref{subsec:params}

Since the size of the neighbourhood is a square of 7x7 cells, the selected
values for (W) are 5x5, 10x10 and 20x20 cells. Furthermore, these sizes would
allow the existence of 25, 100 and 400 agents
respectively at the same time.

Since the maximum lifetime of the agent is about 300 virtual days,
the selected set of days (D) to study are 64, 128 and 256. More days would result in a
huge amount of agents and backstories, harder to evaluate.



%The world size (size of the
%grid in this paper: 5x5, 10x10 or 20x20) can also influence in the
%execution of the story, as larger worlds could make the agents spent
%more time exploring before an event occurs.

The set of values for the food (F), or source of conflicts, that conditions the actions
(attack, share and defend among others) are 1/2, 1/4 and 1/8 of the number of cells of the map.

%also could have enough effect in the story generation: lower
%quantities of food may increase the attacks, creating more aggressive
%agents, and larger quantities may generate more generous
%agents. Different proportions of food depending of the world size will
%be studied (food placed in 1/2, 1/4 and 1/8 of the size of the map). 


The set of values proposed for the population (P) size 
of genetic algorithm are 64, 128 and 256 individuals.

Finally, it is expected that the existence of different number of profiles (S)
in the world will have a significant effect in the runs, 
specially in functions that require more than one archetype.
We will compare the usage of 1, 2, 4 and 8 profiles in each scenario.
As the usage of different number of profiles generate different
individual sizes, and therefore different convergence times, the stop
condition will be established depending of the best fitness 
(30 generations without improvement), to do a fair comparison.

%the parameters of the GA also affect the values of the
%obtained world. In this paper, we study 
%the population size, a
%parameter that has big effect in the execution of this kind of
%algorithms \cite{}, 
% Antonio - CUIDADO! CITA VACÍA!
%comparing populations of 64, 128 and 256
%individuals. %TODO citar a un paper de tamagnos de poblacion
% Explicar tambien los parametros que *no* se prueban y por que *no*
% se hace. - JJ

Table \ref{tab:parameters} summarizes all the configuration parameters that will be compared (with their acronyms used in this paper),
and the rest of the (fixed) parameters of the algorithm. The fixed values of the parameters of the GA have been usually described by other authors as...

The rest of the parameters of the MADE environment, such as the initial number of agents in the world, and the agent's parameters (such as the lifespan) are described in \cite{garcia:anon}. In this paper we will use the default values presented in that work.

\begin{table*}
\begin{center}
\begin{tabular}{|c|c|}
\hline
{\em Parameter} & {\em Values} \\\hline \hline
\multicolumn{2}{|c|}{Parameters under study} \\ \hline \hline
Number of profiles (P) & 1, 2, 4 and 8 \\\hline
Number of virtual days (D) &  64, 128 and 256 \\ \hline
World dimension (W) &  5x5, 10x10 and 20x20 \\ \hline
Food (F) & 1/2, 1/4, 1/8 \\ \hline
GA population size & 64, 128 and 256 \\ \hline
\multicolumn{2}{|c|}{Fixed parameters} \\ \hline \hline
Mutation probability & 1/12 per gene \\ \hline
Parent pool size & Same as pool size \\ \hline
Selection method & Binary tournament \\ \hline 
Elite & 10\%  \\ \hline
Replacement method & Generational\\ \hline
Stop condition & 300 gens. or 30 gens. without improvement \\ \hline
%Stop condition? - JJ FERGU: puesta 
% Without improvemente in what? It's noisy fitness... no change in the
% best individual? - JJ
Runs per configuration & 30 \\ 
Initial world population & 15 \\ \hline
\end{tabular}
\caption{Parameters used in the experiments.}
\label{tab:parameters}
\end{center}
\end{table*}


For a more complete knowledge of the search space and the parameters effects, 
three different sceneries will be studied:
\begin{itemize}
\item $S_1$: Maximization of the ``villain'' archetype.
\item $S_2$: Maximization of the ``villain'' and the ``hero'' archetypes.
\item $S_2$: Maximization of the ``villain'', the ``hero'' and the ``avenger'' archetypes.
\end{itemize}


%In this work, we propose three scenarios:
%\begin{itemize}
%\item Scenario A: The Villains. This scenario only requires one type of archetype: The ``villain''. This % don't leave me this way!!! FERGU: this has to be written by @raiben %(TODO @raiben)
%\item Scenario B: The Hero. As in the classic stories, when a villain appears, a hero must rise. The ``hero'' archetype depend on the existence of a ``villain'' archetype. This %scenario tries to generate worlds formed by archetypes that depend of others.
%\item Scenario C: The Shakespearian story. As many of the great stories of The Bard, this world requires the existence of different and interdependent archetypes: The ``hero'' %and ``villain'' are completed with the ``obstacle'' (QUE HACE QUE), the  ``mentor'' (QUE HACE QUE) and the ``avenger'' (this archetype does not depend on the others).
%\end{itemize}
% Antonio - Esto faltaría completarlo. ;D
% Rubén - todo esto lo he reutilizado para explicarlo en methodology.

%------------------------------------------------------------------------------



%\subsection{Designing a fitness function}
% Rubén - explicado parcialmente en methodology
% mantengo el texto por si resucita.

%-------------------------------------------------------------------------------
%\subsection{Individual representation}
%% FERGU: Como dice Antonio, no sé si esto forma parte de la metodología de este 
%% paper (esto ya se explicó en el ALIFE). He añadido un párrafo para enlazar del 
%% caso general al nuestro concreto.
%
%As explained in the State of the Art, the agents of a massive world can be 
%modelled using different techniques, such as Neural Networks, Finite State 
%Machines or decision trees, among others. To be evolved they can be mapped 
%to a chromosome to be used in the EA. 
%
%In this paper, an individual in the EA is a vector of parameters that model the
%the behaviour of {\em all} the agents in the world simulated by MADE (keep in mind that an
%individual of the EA is not equal to an agent in the world, but a set of values to parametrise them). These
%parameters have been presented in \cite{garcia:anon}, and they define
%the transitions and states of a Finite State Machine that model the
%agent's behaviour. % si lo citas mucho tendria¡s que anonimizarlo para
%                   % el doble blind - JJ FERGU: en principio no decimos 
%                   % en ningún momento "nuestro trabajo anterior" decimos
%                   % que lo usamos porque es libre" 
%
%This vector of parameters is composed by several {\em profiles}. The number of profiles has a direct relation with the desired fitness function. It is expected that functions %with only one kind of archetype (such as F1) only would require one profile (or set of parameters). However, as explained in \cite{garcia:anon}, to allow the existence of %different personalities in the world, different sets of personalities (or profiles) can be evolved at the same time. Therefore, the number of profiles affect the generated %fitness, as the chromosome will be larger. 
%% Chromo what? FERGU: arreglado

%-------------------------------------------------------------------------------



% FERGU: He quitado el "for MADE" del título, recordemos que estamos 
% haciendo esto "en general" pero usando MADE como algo concreto.
% De hecho "exploring the parameter" tampoco me gusta como título
% de sección

%Several parameters related with the world and the GA will be studied
%in this paper so that we can obtain some rule of thumbs on which
%values to use in future experiments, at least as a baseline. As
%explained before, the parameters that define a literary story are the
%time, the world, the characters and the object. In this paper, we use
%the elements defined in MADE: number of days (time), a grid (world),
%food (object) and rats (characters). 

%TODO ruben, que no se te olvide hablar de esto en la intro como viene
%en el issue y que esto relacionado con lo que pongo aqui­. Por
%ejemplo, llamar al "object" de otra forma



% 12 pages is the limit.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Experiments and Results}
\label{sec:res}

In this paper, 9720 runs were carried out for each problem/scenario (30 times * 4 levels for \emph{P} * 2 levels for \emph{D} * 3 levels for \emph{W} * 3 levels for \emph{S} * 3 levels for \emph{F} that represent the possible combinations) to obtain the fitness for each combination.

Since the Kolmogorov-Smirnov test determines that the data we are using
does not follow a normal distribution a non-parametric test, the Kruskal-Wallis test, has been
performed.  % por
                                % favor, Podriais escribir esto EN
                                % INGLES? - JJ FERGU: esto se ha extraido de un paper de ANOVA de hace tiempo, pero he quitado la ultima frase
% podeis NO EXTRAER FRASES MAL ESCRITAS DE PAPERS DE HACE TIEMPO? - JJ
The application of Kruskal-Wallis consisted in running an evolutionary
algorithms using that combination of parameters to obtain the best
fitness. % Queeeee? - JJ 
The response variable used to perform the statistical analysis is the
fitness at the end of the run. The changes in the response variable
are produced when a new combination of parameters is considered. Then,
the {R} \footnote{{\tt http://www.r-project.org}} tool was used to
obtain the Kruskal-Wallis tables as well as the tables of means and
figures for each problem. 

The tables obtained by the Kruskal-Wallis analysis show for each factor the  degrees of freedom (FD), the experimental value of the statistical F (F value) and its associated p-value. If the output is smaller than 0.05, then the
effect of this factor is statistically significant at a $95\%$
confidence level (which indicates that different initial values of
this parameter lead to significant differences on the fitness).

We have obtained values lower than 0.05 for all parameters in all scenarios (generated p-values tables have been omitted due to space constraints). These results show that all the parameters considered have a significant
impact in the generation of the agents behaviour. This confirm our hypothesis that the four elements that conform a story (time, characters, OBJECT and world) have a great repercussion in the generation of stories in the simulation environment. %TODO @raiben poner el concepto del OBJECT que vamos a usar

Since a significant p-value only tells  that the effects are not all
equal (i.e., reject the null hypothesis), post-hoc tests might be used
to determine which effects or outputs are significantly different from
which other. % are we using them? - JJ FERGU: yes, abajo.

Therefore, a Kruskal-Wallis multi-comparison test has also been
performed, showing significant differences among all parameter values,
except for number of profiles (only using 1 profile has significant
difference with respect to use 2, 4 and 8), and GA population size
(64-128 and 128-256), both values (number of profiles and GA population size) in the scenarios Villain and Hero. This
can be explained because only one profile is necessary in these
scenarios (as the hero and villain archetypes are based in attacking
other rats, and therefore, can be shared by the same agent). Therefore, 
the fitness function $F_1$ and $F_2$ only differs in counting the archetype of an ``attacking'' rat almost twice.  % Yo no
                                % lo explicari­a en terminos de lo que
                                % nosotros nos imaginamos, sino en
                                % terminos del propio algoritmo y su
                                % funcion de fitness. FERGU: lo he intentado, pero no lo tengo muy claro @raiben, escribe tu

% Deberias agruparlos por parametro, no por escenario. No estais
% comparando diferentes para¡metros de un escenario, sino diferentes
% niveles para un parametro - JJ FERGU: tienes toda la razon, agrupado
\begin{figure}
        \centering
        \subfigure[\scriptsize{Scenario 1: Villain}]{
                \includegraphics[width=3.7cm]{imags/boxplotz1P.eps}
                \label{fig:e1_p}
        }
        \subfigure[\scriptsize{Scenario 2: Hero}]{
                \includegraphics[width=3.7cm]{imags/boxplotz2P.eps}
                \label{fig:e2_p}
        }
        \subfigure[\scriptsize{Scenario 3: Shakespearian}]{
                \includegraphics[width=3.7cm]{imags/boxplotz5P.eps}
                \label{fig:e3_p}
        }  
        \caption{Boxplots for parameter P (number of profiles)}\label{fig:boxplotsP}
\end{figure}
%
All the results have also been plotted in order to better understand 
their differences (in Figures \ref{fig:boxplotsP} to \ref{fig:boxplotsS}). At first glance, the median for D, W and F is 0 (or almost 0) for several
values. This could have several possible explanations: First, the
number of profiles has quite an impact in the results (Figure
\ref{fig:boxplotsS}), as it was shown previously in
\cite{garcia:anon}. Although no executions achieved the maximum number
of generations (300), % Eso que significa? - JJ
 the length of the chromosome has an effect in the
 convergence. %FERGU: @raiben habra que hacer lo que dice JJ de
              %estudiar que eventos se esten produciendo. El problema
              %es que habr­a que lanzar todo otra vez... Pienso que
              %tampoco sera mala idea hacer un estudio respecto al
              %parametro GENERATION con los Kruskal-Wallis, para ver
              %cuando paran los EAs y justificar mejor este parrafo. 
% No hace falta lanzarlos todos, basta lanzar uno con los mismos
% parametros y visualizar los eventos - JJ
Increasing the number of profiles means changing the search problem
from finding a single finite state automaton whose behaviour
eventually results in a world compatible with our search to finding
two or more compatible with it and among themselves. This also happens
independently of the situation and including complex ones, like the
Shakespeare scenario, so for the time being we should conclude that a
single profile, that is, having the description of a single FSM that
describes the behavior of the agents in the world, is the best option for any scenario. 

\begin{figure}
        \centering
        \subfigure[\scriptsize{Scenario 1: Villain}]{
                \includegraphics[width=3.7cm]{imags/boxplotz1D.eps}
                \label{fig:e1_d}
        }
        \subfigure[\scriptsize{Scenario 2: Hero}]{
                \includegraphics[width=3.7cm]{imags/boxplotz2D.eps}
                \label{fig:e2_d}
        }
        \subfigure[\scriptsize{Scenario 3: Shakespearian}]{
                \includegraphics[width=3.7cm]{imags/boxplotz5D.eps}
                \label{fig:e3_d}
        }  
        \caption{Boxplots for parameter D (number of
          days)}\label{fig:boxplotsD} % Ponedlo al reves: for the
                                % number of days (parameter D). Lo
                                % INTERESANTE es el nombre del
                                % parametro, no el numero.
\end{figure}


\begin{figure}
        \centering
        \subfigure[\scriptsize{Scenario 1: Villain}]{
                \includegraphics[width=3.7cm]{imags/boxplotz1W.eps}
                \label{fig:e1_w}
        }
        \subfigure[\scriptsize{Scenario 2: Hero}]{
                \includegraphics[width=3.7cm]{imags/boxplotz2W.eps}
                \label{fig:e2_w}
        }
        \subfigure[\scriptsize{Scenario 3: Shakespearian}]{
                \includegraphics[width=3.7cm]{imags/boxplotz5W.eps}
                \label{fig:e3_w}
        }  
        \caption{Boxplots for parameter W (world size)}\label{fig:boxplotsW}
\end{figure}

\begin{figure}
        \centering
        \subfigure[\scriptsize{Scenario 1: Villain}]{
                \includegraphics[width=3.7cm]{imags/boxplotz1F.eps}
                \label{fig:e1_f}
        }
        \subfigure[\scriptsize{Scenario 2: Hero}]{
                \includegraphics[width=3.7cm]{imags/boxplotz2F.eps}
                \label{fig:e2_f}
        }
        \subfigure[\scriptsize{Scenario 3: Shakespearian}]{
                \includegraphics[width=3.7cm]{imags/boxplotz5F.eps}
                \label{fig:e3_f}
        }  
        \caption{Boxplots for parameter F (Food amount)}\label{fig:boxplotsF}
\end{figure}

% Por que diablos deci­s parametro D y no lo que hace el parametro? Y
% por que usais with respect en vez de enlazarlo con el anterior?
A similar result is obtained for the number of days, whose results in
the three scenarios can be seen in Figure \ref{fig:boxplotsD}: A small
amount of days (64) is not enough to allow the generation of any
archetype, as there is no time to develop a story, or, in another
words, for the events that we examine to compute fitness to occur, in
most of the scenarios. This can also be said
about the world dimension (Figure \ref{fig:boxplotsW}): larger worlds
are more sparsely populated and have less interaction events, so the chances of an encounter that can trig an event (for
example, a fight) is more difficult. % pero esto habra que probarlo
                                % mirando el numero de encuentros, la
                                % densidad de poblacion, y cosas asi­.
% Cual es la densidad de poblacion en el mundo 5x5? Como evoluciona?
From the study of these two parameters we can conclude that, at least
for these scenarios and possibly for any scenario, the baseline number
of days should be 256 and the world for this population should have a
small size of 25 cells. 

\begin{figure}
        \centering
        \subfigure[\scriptsize{Scenario 1: Villain}]{
                \includegraphics[width=3.7cm]{imags/boxplotz1S.eps}
                \label{fig:e1_s}
        }
        \subfigure[\scriptsize{Scenario 2: Hero}]{
                \includegraphics[width=3.7cm]{imags/boxplotz2S.eps}
                \label{fig:e2_s}
        }
        \subfigure[\scriptsize{Scenario 3: Shakespearian}]{
                \includegraphics[width=3.7cm]{imags/boxplotz5S.eps}
                \label{fig:e3_s}
        }  
        \caption{Boxplots for parameter S (GA population size)}\label{fig:boxplotsS}
\end{figure}

Finally, the amount of food (Figure \ref{fig:boxplotsF}), the
element that has an influence on the occurrence of the actions that
count for the fitness, such as % @raiben dilo aqui­ - JJ
, also need to be low enough so that conflict appear, in this case 1/8
of the world size. % Con un mundo de tamagno 25, Aparecen 3 piezas de
                   % comida? - JJ 


% which is interesting
% because... - JJ FERGU: explicado todo



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Conclusions}



\section*{Acknowledgements}

Hidden for double-blind review

\bibliographystyle{splncs03}
\bibliography{geneura,references}

\end{document}
